@using ResourceManagementSystem2.Models
@using Kendo.Mvc.UI
@model Programmer[]

@{
    ViewBag.Title = "Resource Management System";
}


@using (Html.BeginForm("LogOff", "Account", FormMethod.Post, new { id = "logoutForm" }))
{
    @Html.AntiForgeryToken()
}

@using (Ajax.BeginForm("Index", "Projects", new AjaxOptions { HttpMethod = "Post", UpdateTargetId = "projectsView", OnFailure = "PostFailure", OnSuccess = "PostSuccess", OnComplete = "PostOnComplete" }))
{
    @Html.AntiForgeryToken()
}

@(Html.Kendo().Scheduler<ProjectViewModel>()
            .Name("scheduler")
            .Editable(true)
            .Date(DateTime.Now)
            .StartTime(DateTime.MinValue)
            .Views(views =>
            {
                views.TimelineMonthView(timeline =>
                {
                    timeline.StartTime(DateTime.MinValue);
                    timeline.EndTime(DateTime.MaxValue);
                    timeline.EventHeight(50);
                });
            })
            .Group(group => group.Resources("Programmers").Orientation(SchedulerGroupOrientation.Vertical))
            .Resources(resource =>
            {
                resource.Add(m => m.Programmers)//для окошка добавления
            .Title("Programmers")
            .Name("Programmers")
            .DataTextField("Name")
            .DataValueField("ProgrammerID")
            .BindTo(@Model);

                resource.Add(m => m.Color)
                .Title("Color")
                .Name("Color")
                .DataTextField("Color")
                .DataValueField("Color")
                .DataColorField("Color")
                .DataSource(ds => ds.Read("GetProjectColors", "Scheduler"));
            })

    .DataSource(d => d
            .Model(m =>
            {
                m.Id(f => f.ProjectViewModelID);
                m.Field(f => f.Title).DefaultValue("No title");
                m.RecurrenceId(f => f.RecurrenceId);
                m.Field(f => f.Title).DefaultValue("No title");
            })
            .Read("ReadProjects", "Scheduler")
            .Create("CreateProject", "Scheduler")
            .Destroy("DestroyProject", "Scheduler")
            .Update("UpdateProject", "Scheduler")
    )
)

@{Html.RenderAction("Index", "Projects");}

<script>
    $(function () {
        $(".k-scheduler-toolbar").append("<a id=\"projectsButton\" href=\"javascript:document.getElementById('showProjectsForm').submit()\" class=\"k-link\">Проекты</a>");
        $("#projectsButton").bind('click', function () {
            $("#window").data("kendoWindow").center().open();
        });
        $(".k-scheduler-toolbar").append("<a id=\"logOffButton\" href=\"javascript:document.getElementById('logoutForm').submit()\" class=\"k-link\">Выйти</a>");
    })
</script>


